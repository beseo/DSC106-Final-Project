<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Stay Predictors</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="updateChart.js"></script>
    <script type="module" src="global.js"></script>
</head>
<body>
    <!-- Hero Section -->
    <header class="hero">
        <h1>Admitted Today, Discharged When?</h1>
        <p>Unraveling the biggest factors that affect hospital stay length.</p>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Introduction Section -->
        <section class="intro">
            <h2>About the Project</h2>
            <p>
                This project explores the key factors from preoperative and demographic data influencing hospital stay length. 
                By analyzing preoperative data, we aim to help patients, hospitals, and insurance companies 
                better plan and manage resources.
            </p>
            
            <div class="center-wrapper">
                <button class="cta-button" onclick="scrollToChart()">Explore the Data</button>
            </div>            

            <section>
                <h2>Top Factors Impacting Hospital Stay Length</h2>
                <p>
                    We utilized a machine learning method, specifically a Random Tree Classifier, 
                    to identify the top three most important features that impact the length of hospital stay from the dataset.
                </p>
                <p>Here are the key features we discovered:</p>
                <ul>
                    <li><strong>Preoperative Albumin (preop_alb):</strong> Indicates nutritional status and correlates with recovery times.</li>
                    <li><strong>Operation Type - Colorectal (optype_colorectal):</strong> Reflects the impact of colorectal surgeries.</li>
                    <li><strong>Operation Type - Stomach (optype_stomach):</strong> Accounts for stomach surgeries and their associated recovery requirements.</li>
                </ul>
                <p>
                    You can explore these variables in the interactive visualization below.
                </p>

                <div class="scrolly">
                    <div class="graphic-container">
                        <canvas id="graphicCanvas"></canvas>
                        <div class="overlay-message" id="overlay-message2">Scroll down the right-hand navigation to see the top three most important features!</div>
                    </div>
            
                    <div class="scroll-container">
                        <section class="text-section" data-variable="preop_alb_categ">
                          <h2>Albumin Level</h2>
                          <p>This is the first section of content.</p>
                        </section>
                        <section class="text-section" data-variable="optype_Colorectal">
                          <h2>Operation Type (Colorectal)</h2>
                          <p>This is the second section of content.</p>
                        </section>
                        <section class="text-section" data-variable="optype_Stomach">
                          <h2>Operation Type (Stomach)</h2>
                          <p>This is the third section of content.</p>
                        </section>
                    </div>
                </div>
            </section>

            <h2>More Exploration</h2>

        </section>

        <!-- Chart Section -->
        <section class="chart-section">
            <h2>Explore Hospital Stay Predictors</h2>
            <p class="graph-intro">
                These are the preoperative and demographic features that we are going to look at. 
                <strong>Select a variable from the dropdown</strong> below to see how it affects the average length of hospital stay.
                <strong>Hover over each bar</strong> to view detailed information about each category within the selected variable.
            </p>
            <select id="selection" name="selection">
                <option value="start_option" disabled selected>Select a variable</option>
                <option value="asa">ASA</option>
                <option value="age_group">Age</option>
                <option value="sex">Gender</option>
                <option value="bmi_category">BMI</option>
                <option value="department">Department</option>
                <option value="approach">Surgical Approach</option>
                <option value="position">Surgical Position</option>
                <option value="ane_type">Anesthesia Type</option>
                <option value="optype">Operation Type</option>
                <option value="preop_ecg">Preoperative ECG</option>
                <option value="preop_pft">Preoperative Pulmonary Function</option>
                <option value="preop_htn">Preoperative Hypertension</option>
                <option value="preop_dm">Preoperative Diabetes</option>
                <option value="death_inhosp">In-Hospital Death</option>
                <option value="emop">Emergency Operation</option>
                <option value="preop_alb_categ">Preoperative Albumin</option>
                <option value="preop_hb_categ">Preoperative Hemoglobin</option>
            </select>
            <div class="chart-wrapper">
                <canvas id="chart-container" width="400" height="200"></canvas>
                <div class="overlay-message" id="overlay-message">Please select a variable to explore</div>
            </div>
        </section>

        <!-- Explanation Box -->
        <aside class="explanation-box" id="explanation-box">
            <h3>Variable Explanation</h3>
            <p id="variable-explanation">Select a variable to see its explanation here.</p>
        </aside>

        <section class = "model">
            <h2>Hospital Stay Filter & Analysis Tool</h2>
            <p>Filter patients and visualize hospital stay length.</p>
            <div class="form-container">
                <form id="filter-form">
                    <div class="form-group">
                        <label for="albumin-category">Albumin Range (g/dL):</label>
                        <select id="albumin-category" name="albumin-category">
                            <option value="start" disabled selected>Select</option>
                            <option value="0.0–2.4">0.0–2.4</option>
                            <option value="2.5–3.4">2.5–3.4</option>
                            <option value="3.5–4.9">3.5–4.9</option>
                            <option value="5.0+">5.0+</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="colorectal-checkbox" name="operation" value="colorectal">
                            Operation Type (Colorectal)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="stomach-checkbox" name="operation" value="stomach">
                            Operation Type (Stomach)
                        </label>
                    </div>
                    <button id="filter-button" type="button" onclick="filterData()">Show Data</button>
                </form>
            </div>

            <div id="result" style="margin-top: 20px;"></div> <!-- The result div -->
            
            <div class="distribution">
                <div id="hospitalStayChart"></div>   
            </div>
            
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>Created by Nomin Batjargal, Max Zou, Terran Chow, and Beomsuk Seo</p>
    </footer>

    <script>
        function scrollToChart() {
            document.querySelector('.chart-section').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>